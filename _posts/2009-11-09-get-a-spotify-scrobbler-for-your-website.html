---
layout: post
title: Get a Spotify scrobbler for your website
tags:
- spotify
status: draft
type: post
published: false
meta:
  _edit_last: '1'
---
If you're like me and use <a href="http://spotify.com">Spotify</a> you might be interrested in this little hack i found.
Spotify Has the ability to publish what you listen to to <a href="http://last.fm">last.fm</a>.
Following is a quick and easy way to get your spotify listens scrobbled on your website:
<ol>
	<li> First go get yourself a <a href="https://www.last.fm/join">last.fm account</a>, it's free :)</li>
	<li>Set spotify to scrobble to last.fm by going to Edit &gt; Preferences. Here you will need to check the box for last.fm and add your credentials<a href="http://www.glxn.net/wp-content/uploads/2009/11/spotify.png"><img class="size-full wp-image-38 alignnone" title="spotify" src="http://www.glxn.net/wp-content/uploads/2009/11/spotify.png" alt="spotify" width="440" height="291" /></a></li>
	<li>Next go to <a rel="nofollow" href="http://www.last.fm/tools/charts">http://www.last.fm/tools/charts</a> and find a widget you like.</li>
	<li>Embed the kode and off you go</li>
</ol>
The last.fm widget seems to deny requests every so often, so i came up with a script that will make a local cached copy that you can serve instead of having the widget dissapear for some requests.
You need to set up a cron to fetch the widget to a place you configure on the server. Then you change the reference in the src og the img tag to point to your local copy of the file. The folowing script set up with a cron of every 5 mimuntes should be sufficient:
<div style="border: thin dashed black; background: #efefef;">
<pre>#!/bin/bash
cd /root/wordpress/lastfm
wget -r -nd --retry-connrefused http://imagegen.last.fm/listen/recenttracks/kenglxn.gif -O kenglxn.gif.tmp
GIF_SIZE=`stat -c %s "kenglxn.gif.tmp"`
if [ "$GIF_SIZE" -gt 6000 ]
then
    cp -f kenglxn.gif.tmp kenglxn.gif
    fi
exit 0</pre>
</div>
<strong>Happy scrobbling</strong>
